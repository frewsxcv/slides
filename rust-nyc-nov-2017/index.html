<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>
      @import url('https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Serif|Inconsolata');

      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4, h5, h6 {
        font-family: 'Droid Sans';
        font-weight: normal;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Inconsolata';
      }

      .footnote {
        font-size: 0.8em;
      }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# building a threadpool in N minutes

???

https://github.com/Kimundi/scoped-threadpool-rs/blob/master/src/lib.rs

kimundi.github.io/scoped-threadpool-rs/scoped_threadpool/struct.Scope.html

https://doc.servo.org/src/rayon_core/thread_pool/mod.rs.html#47-49

---

class: center, middle

# who

## corey farwell / rwell.org / frewsxcv

---

# Agenda

1. Introduction
2. Deep-dive
3. ...

---

# Introduction

---

```rust
fn resize_image(path: &str) {

}
```

---

```rust
let paths = glob::glob("dogs/*").unwrap();

paths.for_each(|path| {
    resize_image(path);
});

println!("done! 🐶");
```

---

```rust
let paths = glob::glob("dogs/*").unwrap();

let mut handles = vec![];

paths.for_each(|path| {
    let handle = std::thread::spawn(|| {
        resize_image(path)
    }).unwrap();

    handles.push(handle);
});

handles.for_each(|handle| {
    handle.join().unwrap();
})
```

---

Demonstrate usability issues of scopeless threadpool

---

Show how to accomplish scopeless threadpool issues with barrier

---

Show scoped

---



---

```rust
/// Returns a handle to the global thread pool. This is the pool
/// that Rayon will use by default when you perform a `join()` or
/// `scope()` operation, if no other thread-pool is installed. If
/// no global thread-pool has yet been started when this function
/// is called, then the global thread-pool will be created (with
/// the default configuration). If you wish to configure the
/// global thread-pool differently, then you can use [the
/// `rayon::initialize()` function][f] to do so.
///
/// [f]: fn.initialize.html
pub fn global() -> &'static Arc<ThreadPool> {
    lazy_static! {
        static ref DEFAULT_THREAD_POOL: Arc<ThreadPool> =
            Arc::new(ThreadPool { registry: Registry::global() });
    }

    &DEFAULT_THREAD_POOL
}
```

.footnote[https://github.com/rayon-rs/rayon/blob/master/rayon-core/src/thread_pool/mod.rs]

???

'image' crate uses rayon _and_ scoped_threadpool
    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
